<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Systematic</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="canvasContainer">
    <canvas id="game" width="1350" height="480"></canvas>
    <button id="toggleControls" style="position:absolute; top:10px; right:10px; background:#444; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; z-index:10;">
      Show Controls
    </button>
    <div id="controls" style="display:none; position:absolute; top:50px; right:10px; background:#222; padding:10px; border-radius:8px; z-index:10; flex-direction:column; gap:1em;">
      <button id="playtestBtn" style="width:150px;">Playtest</button>
      <button id="saveLevel"   style="width:150px;">Save All Levels</button>
      <button id="loadLevel"   style="width:150px;">Load All Levels</button>
      <input type="file" id="loadLevelFile" accept=".json" style="display:none" />
      <button onclick="uploadCurrentLevel()">Upload Level</button>
      <button onclick="loadLevelFromFirebase()">Load Shared Level</button>
      <button id="browseShared">Browse Shared Levels</button>
      <button id="viewDocsBtn">Features & Docs</button>
    </div>
  </div>
  <div id="paletteWrapper" style="width:824px; margin:10px auto; background:#111; overflow:hidden;">
    <div id="levelControls" style="text-align:center; margin:10px;">
      <button id="prevLevel">‚Üê Prev Level</button>
      <span id="levelLabel">Level 1</span>
      <button id="nextLevel">Next Level ‚Üí</button>
      <button id="addLevel">+ Add Level</button>
    </div>
    <div id="Toolbar" style="display:flex; align-items:center; gap:0.5em; padding:8px; background:#222; margin:0 auto 10px; border-radius:4px; width:fit-content;">
      <label style="color:#fff;">
        <input id="tileSearch" type="text" placeholder="Name or ID‚Ä¶" style="padding:4px; margin-left:6px; width:200px;">
      </label>
      <label style="font-size:14px;">
        Category:
        <select id="categorySelector"></select>
      </label>
      <label>
        Palette:
        <select id="paletteSelector"></select>
        <div id="paletteDisplay"></div>
      </label>
      <label>
        Layer:
        <select id="layerSelector">
          <option value="1">Terrain</option>
          <option value="0">Background</option>
        </select>
      </label>
      <button id="openSpriteEditor" title="Create new sprite">
        üñåÔ∏è
      </button>
      <label for="loadSpriteLoader" style="margin-left:8px;cursor:pointer;">
      üìÇ Load Sprites
      <input type="file" id="loadSpriteLoader" accept=".json,.txt" style="display:none;" />
    </label>
    </div>
    <div id="tileBrushes"></div>
  </div>
  <div id="tileProps">
    <h3>Tile Properties</h3>
    <p><strong>Pos:</strong> <span id="propXY"></span></p>
    <div id="customProps"></div>
    <button id="propApply">Apply</button>
    <button id="propClose">Close</button>
  </div>
<div id="spriteEditorModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:1em; border:1px solid #666; z-index:1000;">
  <h3>New Sprite</h3>
  <div id="spriteGrid" style="display:grid; grid-template-columns:repeat(10,30px); grid-template-rows:repeat(10,30px); gap:1px; margin-bottom:12px;"></div>
  <div id="editorPaletteSwatch" style="margin-bottom:6px;"></div>
  <input type="text" id="spriteEditorName" placeholder="Sprite name" style="width:50%; margin:0.5em 0;" />
  <button id="spriteEditorSave">Save</button>
  <button id="spriteEditorCancel">Cancel</button>
</div>
<!-- Modal backdrop & window -->
<div id="sharedModalBackdrop">
  <div id="sharedModal">
    <header>Shared Levels</header>
    <ul id="sharedList">
      <!-- populated dynamically -->
    </ul>
    <footer>
      <button id="closeShared">Close</button>
    </footer>
  </div>
</div>
<div id="docsModal" class="modal-backdrop" style="display:none; align-items:center; justify-content:center;">
  <div class="modal" style="background:#222; color:#eee; width:80%; max-height:80%; overflow:auto; padding:1em; border-radius:4px;">
    <button id="closeDocs" style="float:right">‚úï</button>
    <div id="docsContent">Loading‚Ä¶</div>
  </div>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lz-string/libs/lz-string.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase Configuration - Load from environment variables or fallback to development config
  const firebaseConfig = {
    apiKey: typeof FIREBASE_API_KEY !== 'undefined' ? FIREBASE_API_KEY : null,
    authDomain: typeof FIREBASE_AUTH_DOMAIN !== 'undefined' ? FIREBASE_AUTH_DOMAIN : null,
    databaseURL: typeof FIREBASE_DATABASE_URL !== 'undefined' ? FIREBASE_DATABASE_URL : null,
    projectId: typeof FIREBASE_PROJECT_ID !== 'undefined' ? FIREBASE_PROJECT_ID : null,
    storageBucket: typeof FIREBASE_STORAGE_BUCKET !== 'undefined' ? FIREBASE_STORAGE_BUCKET : null,
    messagingSenderId: typeof FIREBASE_MESSAGING_SENDER_ID !== 'undefined' ? FIREBASE_MESSAGING_SENDER_ID : null,
    appId: typeof FIREBASE_APP_ID !== 'undefined' ? FIREBASE_APP_ID : null
  };

  // Security check - warn if using development config in production
  if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    if (typeof FIREBASE_API_KEY === 'undefined') {
      console.warn('‚ö†Ô∏è Security Warning: Using development Firebase config in production environment');
      console.warn('Please set up environment variables for production deployment');
    }
  }

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<!--Sprites-->
<script src="sprites.js"></script>

<!--Core Game-->
<script src="core.js"></script>

<!--Apply Updates-->
<script src="updates/update1.js"></script>
<script src="updates/update2.js"></script>

<!--Uncomment the scripts below to load examplemods-->
<!--<script src="mods/examplemod/exampleplayerabiltity.js"></script>-->
<!--<script src="mods/examplemod/examplepalette.js"></script>-->
<!--<script src="mods/examplemod/exampleplacekey.js"></script>-->
<!--<script src="mods/examplemod/examplemodal.js"></script>-->
<!--<script src="mods/examplemod/exampleparticle.js"></script>-->
<!--<script src="mods/examplemod/examplefalldamage.js"></script>-->
<!--Add more mods by placing more scripts here-->

</html>